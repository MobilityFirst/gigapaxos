# Primary Backup Manager

Primary Backup Manager (`PrimaryBackupManager`) is a manager for Primary Backup 
Replica Coordinator used in Gigapaxos. The `PrimaryBackupManager` uses Paxos to 
agree on the order of StateDiff and primary changes, in all the Nodes.

## TODO
- [ ] Consistently use `App` or `Service`. Currently, both terms are used 
      interchangeably, potential confusion for contributing developers. 
- [ ] Implement `CoordinatorMultiplexer` in XDN.

## Request Encapsulation

There are one main packet types that `PrimaryBackupManager` can handle: 
`PrimaryBackupPacket`.

The coordinator, `PrimaryBackupReplicaCoordinator`, offloads the coordination
to the `PrimaryBackupManager`. The coordinator handles two request/packet types:
`ReplicableClientRequest` and `PrimaryBackupPacket`. Other request/packet types
will cause runtime exception, and thus will be ignored.

`ReplicableClientRequest` encapsulates AppRequest coming from the end user.
For example, in the `MonotonicApp`, `MonotonicAppRequest` is the AppRequest,
it implements `ClientRequest` interface so the Application (i.e., `MonotonicApp`) 
and `PrimaryBackupManager` can pass the response, generated by the Application.

Because `PrimaryBackupManager` can only handle `PrimaryBackupPacket`, when the 
coordinator receives `ReplicableClientRequest`, a specific request coming from end 
user, the coordinator will unwrap the encapsulated AppRequest and re-encapsulate 
the AppRequest inside `RequestPacket`, an inheritance of `PrimaryBackupPacket`. 
This re-encapsulation is illustrated in the figure below, the process happens 
in the `coordinateRequest(.)` method in the `PrimaryBackupReplicaCoordinator`.

```
┌─────────────────────────┐          ┌────────────────┐
│ReplicableClientRequest  │          │RequestPacket   │
│ ┌───────────────────────┤   ───►   │  ┌─────────────┤
│ │AppRequest             │          │  │AppRequest   │
└─┴───────────────────────┘          └──┴─────────────┘
```
Other instances of `PrimaryBackupPacket` include `ApplyStateDiffPacket`, 
`StartEpochPacket` and others specified in the `PrimaryBackupPacketType`
at the `packets` directory.

> Note: The use of `ReplicableClientRequest` mainly because of the same 
approach used in other replica coordinator (e.g., Gigapaxos). We might 
remove it in the future so `PrimaryBackupReplicaCoordinator` exclusively 
only handle `PrimaryBackupPacket`, and not other kind of request/packet.

In general, `PrimaryBackupPacket` is exclusively handled in the coordination 
layer, while AppRequest is exclusively handled in the Application layer, 
below coordination layer. 

## Request Execution

## Coordinator Description

Assumption about the underlying Paxos Library:

